<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>class I2S – Inter-IC Sound bus protocol &mdash; readthedocs  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> readthedocs
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="uartremote.html">uartremote.py – Robust comminiation over UART</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">readthedocs</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>class I2S – Inter-IC Sound bus protocol</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/machine.I2S.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="class-i2s-inter-ic-sound-bus-protocol">
<span id="machine-i2s"></span><h1>class I2S – Inter-IC Sound bus protocol<a class="headerlink" href="#class-i2s-inter-ic-sound-bus-protocol" title="Permalink to this headline"></a></h1>
<p>I2S is a synchronous serial protocol used to connect digital audio devices.
At the physical level, a bus consists of 3 lines: SCK, WS, SD.
The I2S class supports controller operation.  Peripheral operation is not supported.</p>
<p>The I2S class is currently available as a Technical Preview.  During the preview period, feedback from
users is encouraged.  Based on this feedback, the I2S class API and implementation may be changed.</p>
<p>I2S objects can be created and initialized using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">machine</span> <span class="kn">import</span> <span class="n">I2S</span>
<span class="kn">from</span> <span class="nn">machine</span> <span class="kn">import</span> <span class="n">Pin</span>

<span class="c1"># ESP32</span>
<span class="n">sck_pin</span> <span class="o">=</span> <span class="n">Pin</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>   <span class="c1"># Serial clock output</span>
<span class="n">ws_pin</span> <span class="o">=</span> <span class="n">Pin</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span>    <span class="c1"># Word clock output</span>
<span class="n">sd_pin</span> <span class="o">=</span> <span class="n">Pin</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>    <span class="c1"># Serial data output</span>

<span class="ow">or</span>

<span class="c1"># PyBoards</span>
<span class="n">sck_pin</span> <span class="o">=</span> <span class="n">Pin</span><span class="p">(</span><span class="s2">&quot;Y6&quot;</span><span class="p">)</span>   <span class="c1"># Serial clock output</span>
<span class="n">ws_pin</span> <span class="o">=</span> <span class="n">Pin</span><span class="p">(</span><span class="s2">&quot;Y5&quot;</span><span class="p">)</span>    <span class="c1"># Word clock output</span>
<span class="n">sd_pin</span> <span class="o">=</span> <span class="n">Pin</span><span class="p">(</span><span class="s2">&quot;Y8&quot;</span><span class="p">)</span>    <span class="c1"># Serial data output</span>

<span class="n">audio_out</span> <span class="o">=</span> <span class="n">I2S</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">sck</span><span class="o">=</span><span class="n">sck_pin</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="n">ws_pin</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="n">sd_pin</span><span class="p">,</span>
                <span class="n">mode</span><span class="o">=</span><span class="n">I2S</span><span class="o">.</span><span class="n">TX</span><span class="p">,</span>
                <span class="n">bits</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
                <span class="nb">format</span><span class="o">=</span><span class="n">I2S</span><span class="o">.</span><span class="n">MONO</span><span class="p">,</span>
                <span class="n">rate</span><span class="o">=</span><span class="mi">44100</span><span class="p">,</span>
                <span class="n">ibuf</span><span class="o">=</span><span class="mi">20000</span><span class="p">)</span>

<span class="n">audio_in</span> <span class="o">=</span> <span class="n">I2S</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>
               <span class="n">sck</span><span class="o">=</span><span class="n">sck_pin</span><span class="p">,</span> <span class="n">ws</span><span class="o">=</span><span class="n">ws_pin</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="n">sd_pin</span><span class="p">,</span>
               <span class="n">mode</span><span class="o">=</span><span class="n">I2S</span><span class="o">.</span><span class="n">RX</span><span class="p">,</span>
               <span class="n">bits</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
               <span class="nb">format</span><span class="o">=</span><span class="n">I2S</span><span class="o">.</span><span class="n">STEREO</span><span class="p">,</span>
               <span class="n">rate</span><span class="o">=</span><span class="mi">22050</span><span class="p">,</span>
               <span class="n">ibuf</span><span class="o">=</span><span class="mi">20000</span><span class="p">)</span>
</pre></div>
</div>
<dl class="simple">
<dt>3 modes of operation are supported:</dt><dd><ul class="simple">
<li><p>blocking</p></li>
<li><p>non-blocking</p></li>
<li><p>uasyncio</p></li>
</ul>
</dd>
</dl>
<p>blocking:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">num_written</span> <span class="o">=</span> <span class="n">audio_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="c1"># blocks until buf emptied</span>

<span class="n">num_read</span> <span class="o">=</span> <span class="n">audio_in</span><span class="o">.</span><span class="n">readinto</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="c1"># blocks until buf filled</span>
</pre></div>
</div>
<p>non-blocking:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">audio_out</span><span class="o">.</span><span class="n">irq</span><span class="p">(</span><span class="n">i2s_callback</span><span class="p">)</span>         <span class="c1"># i2s_callback is called when buf is emptied</span>
<span class="n">num_written</span> <span class="o">=</span> <span class="n">audio_out</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>  <span class="c1"># returns immediately</span>

<span class="n">audio_in</span><span class="o">.</span><span class="n">irq</span><span class="p">(</span><span class="n">i2s_callback</span><span class="p">)</span>          <span class="c1"># i2s_callback is called when buf is filled</span>
<span class="n">num_read</span> <span class="o">=</span> <span class="n">audio_in</span><span class="o">.</span><span class="n">readinto</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>   <span class="c1"># returns immediately</span>
</pre></div>
</div>
<p>uasyncio:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">swriter</span> <span class="o">=</span> <span class="n">uasyncio</span><span class="o">.</span><span class="n">StreamWriter</span><span class="p">(</span><span class="n">audio_out</span><span class="p">)</span>
<span class="n">swriter</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
<span class="k">await</span> <span class="n">swriter</span><span class="o">.</span><span class="n">drain</span><span class="p">()</span>

<span class="n">sreader</span> <span class="o">=</span> <span class="n">uasyncio</span><span class="o">.</span><span class="n">StreamReader</span><span class="p">(</span><span class="n">audio_in</span><span class="p">)</span>
<span class="n">num_read</span> <span class="o">=</span> <span class="k">await</span> <span class="n">sreader</span><span class="o">.</span><span class="n">readinto</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
</pre></div>
</div>
<section id="constructor">
<h2>Constructor<a class="headerlink" href="#constructor" title="Permalink to this headline"></a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="machine.I2S">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">machine.</span></span><span class="sig-name descname"><span class="pre">I2S</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">id</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sck</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ws</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mode</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">format</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rate</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ibuf</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#machine.I2S" title="Permalink to this definition"></a></dt>
<dd><p>Construct an I2S object of the given id:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">id</span></code> identifies a particular I2S bus.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">id</span></code> is board and port specific:</p>
<blockquote>
<div><ul class="simple">
<li><p>PYBv1.0/v1.1: has one I2S bus with id=2.</p></li>
<li><p>PYBD-SFxW: has two I2S buses with id=1 and id=2.</p></li>
<li><p>ESP32: has two I2S buses with id=0 and id=1.</p></li>
</ul>
</div></blockquote>
<p>Keyword-only parameters that are supported on all ports:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sck</span></code> is a pin object for the serial clock line</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ws</span></code> is a pin object for the word select line</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sd</span></code> is a pin object for the serial data line</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mode</span></code> specifies receive or transmit</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bits</span></code> specifies sample size (bits), 16 or 32</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">format</span></code> specifies channel format, STEREO or MONO</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rate</span></code> specifies audio sampling rate (samples/s)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ibuf</span></code> specifies internal buffer length (bytes)</p></li>
</ul>
</div></blockquote>
<p>For all ports, DMA runs continuously in the background and allows user applications to perform other operations while
sample data is transfered between the internal buffer and the I2S peripheral unit.
Increasing the size of the internal buffer has the potential to increase the time that user applications can perform non-I2S operations
before underflow (e.g. <code class="docutils literal notranslate"><span class="pre">write</span></code> method) or overflow (e.g. <code class="docutils literal notranslate"><span class="pre">readinto</span></code> method).</p>
</dd></dl>

</section>
<section id="methods">
<h2>Methods<a class="headerlink" href="#methods" title="Permalink to this headline"></a></h2>
<dl class="py method">
<dt class="sig sig-object py" id="machine.I2S.init">
<span class="sig-prename descclassname"><span class="pre">I2S.</span></span><span class="sig-name descname"><span class="pre">init</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sck</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">...</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#machine.I2S.init" title="Permalink to this definition"></a></dt>
<dd><p>see Constructor for argument descriptions</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="machine.I2S.deinit">
<span class="sig-prename descclassname"><span class="pre">I2S.</span></span><span class="sig-name descname"><span class="pre">deinit</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#machine.I2S.deinit" title="Permalink to this definition"></a></dt>
<dd><p>Deinitialize the I2S bus</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="machine.I2S.readinto">
<span class="sig-prename descclassname"><span class="pre">I2S.</span></span><span class="sig-name descname"><span class="pre">readinto</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">buf</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#machine.I2S.readinto" title="Permalink to this definition"></a></dt>
<dd><p>Read audio samples into the buffer specified by <code class="docutils literal notranslate"><span class="pre">buf</span></code>.  <code class="docutils literal notranslate"><span class="pre">buf</span></code> must support the buffer protocol, such as bytearray or array.
“buf” byte ordering is little-endian.  For Stereo format, left channel sample precedes right channel sample. For Mono format,
the left channel sample data is used.
Returns number of bytes read</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="machine.I2S.write">
<span class="sig-prename descclassname"><span class="pre">I2S.</span></span><span class="sig-name descname"><span class="pre">write</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">buf</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#machine.I2S.write" title="Permalink to this definition"></a></dt>
<dd><p>Write audio samples contained in <code class="docutils literal notranslate"><span class="pre">buf</span></code>. <code class="docutils literal notranslate"><span class="pre">buf</span></code> must support the buffer protocol, such as bytearray or array.
“buf” byte ordering is little-endian.  For Stereo format, left channel sample precedes right channel sample. For Mono format,
the sample data is written to both the right and left channels.
Returns number of bytes written</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="machine.I2S.irq">
<span class="sig-prename descclassname"><span class="pre">I2S.</span></span><span class="sig-name descname"><span class="pre">irq</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">handler</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#machine.I2S.irq" title="Permalink to this definition"></a></dt>
<dd><p>Set a callback. <code class="docutils literal notranslate"><span class="pre">handler</span></code> is called when <code class="docutils literal notranslate"><span class="pre">buf</span></code> is emptied (<code class="docutils literal notranslate"><span class="pre">write</span></code> method) or becomes full (<code class="docutils literal notranslate"><span class="pre">readinto</span></code> method).
Setting a callback changes the <code class="docutils literal notranslate"><span class="pre">write</span></code> and <code class="docutils literal notranslate"><span class="pre">readinto</span></code> methods to non-blocking operation.
<code class="docutils literal notranslate"><span class="pre">handler</span></code> is called in the context of the MicroPython scheduler.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="machine.I2S.shift">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">I2S.</span></span><span class="sig-name descname"><span class="pre">shift</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">buf</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shift</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#machine.I2S.shift" title="Permalink to this definition"></a></dt>
<dd><p>bitwise shift of all samples contained in <code class="docutils literal notranslate"><span class="pre">buf</span></code>. <code class="docutils literal notranslate"><span class="pre">bits</span></code> specifies sample size in bits. <code class="docutils literal notranslate"><span class="pre">shift</span></code> specifies the number of bits to shift each sample.
Positive for left shift, negative for right shift.
Typically used for volume control.  Each bit shift changes sample volume by 6dB.</p>
</dd></dl>

</section>
<section id="constants">
<h2>Constants<a class="headerlink" href="#constants" title="Permalink to this headline"></a></h2>
<dl class="py data">
<dt class="sig sig-object py" id="machine.I2S.RX">
<span class="sig-prename descclassname"><span class="pre">I2S.</span></span><span class="sig-name descname"><span class="pre">RX</span></span><a class="headerlink" href="#machine.I2S.RX" title="Permalink to this definition"></a></dt>
<dd><p>for initialising the I2S bus <code class="docutils literal notranslate"><span class="pre">mode</span></code> to receive</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="machine.I2S.TX">
<span class="sig-prename descclassname"><span class="pre">I2S.</span></span><span class="sig-name descname"><span class="pre">TX</span></span><a class="headerlink" href="#machine.I2S.TX" title="Permalink to this definition"></a></dt>
<dd><p>for initialising the I2S bus <code class="docutils literal notranslate"><span class="pre">mode</span></code> to transmit</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="machine.I2S.STEREO">
<span class="sig-prename descclassname"><span class="pre">I2S.</span></span><span class="sig-name descname"><span class="pre">STEREO</span></span><a class="headerlink" href="#machine.I2S.STEREO" title="Permalink to this definition"></a></dt>
<dd><p>for initialising the I2S bus <code class="docutils literal notranslate"><span class="pre">format</span></code> to stereo</p>
</dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="machine.I2S.MONO">
<span class="sig-prename descclassname"><span class="pre">I2S.</span></span><span class="sig-name descname"><span class="pre">MONO</span></span><a class="headerlink" href="#machine.I2S.MONO" title="Permalink to this definition"></a></dt>
<dd><p>for initialising the I2S bus <code class="docutils literal notranslate"><span class="pre">format</span></code> to mono</p>
</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Ste7an.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>